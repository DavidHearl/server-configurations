{% extends 'base.html' %}
{% block content %}
<h2>Systems</h2>
{% if systems %}
    <table border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse; width:100%; background:#fff;">
        <thead style="background:#f0f0f0;">
            <tr>
                <th>U</th>
                <th>Rack Area</th>
                <th>System Name</th>
                <th>Component Type</th>
                <th>Model</th>
                <th>Qty</th>
                <th>Price (Each)</th>
                <th>Total (Line)</th>
                <th>Link</th>
                <th>Sourcing Notes</th>
            </tr>
        </thead>
        <tbody>
        {% for system in systems %}
            {% for comp in system.components.all %}
            <tr>
                {% if forloop.first %}
                    <td rowspan="{{ system.components.count|default:1 }}">{{ system.size }}</td>
                    <td rowspan="{{ system.components.count|default:1 }}">{{ system.rack }}</td>
                    <td rowspan="{{ system.components.count|default:1 }}">{{ system.name }}</td>
                {% endif %}
                <td>{{ comp.get_component_type_display }}</td>
                <td>{{ comp.model }}</td>
                <td>1</td>
                <td>£{{ comp.unit_price }}</td>
                <td>£{{ comp.unit_price }}</td>
                <td>
                    {% if comp.link_justification %}
                        <a href="{{ comp.link_justification }}" target="_blank">Link</a>
                    {% endif %}
                </td>
                <td></td>
            </tr>
            {% empty %}
            <tr>
                <td>{{ system.size }}</td>
                <td>{{ system.rack }}</td>
                <td>{{ system.name }}</td>
                <td colspan="7">No components</td>
            </tr>
            {% endfor %}
            <tr style="background:#f9f9f9;">
                <td colspan="7"></td>
                <td colspan="2" style="text-align:right;"><strong>Total:</strong></td>
                <td>
                    £{{ system.total_price|floatformat:2 }}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No systems.</p>
{% endif %}

<hr>
<h3>Add System</h3>
<form method="post" action="{% url 'add_system' %}">
    {% csrf_token %}
    {{ system_form.as_p }}
    <button type="submit">Add System</button>
</form>

<hr>
<h3>Add Component</h3>
<form method="post" action="{% url 'add_component' %}">
    {% csrf_token %}
    {{ component_form.as_p }}
    <button type="submit">Add Component</button>
</form>
{% endblock %}